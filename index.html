<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HumairaStudio — Creative Blog</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            violet: '#8A2BE2',
            babypink: '#FFB6C1'
          }
        }
      }
    }
  </script>

  <style>
    :root{
      --primary:#8A2BE2;
      --accent:#FFB6C1;
    }
    body{font-family:'Poppins',sans-serif;background:linear-gradient(180deg, #fff, #fff);color:#1f2937;min-height:100vh}
    .dancing {font-family:'Dancing Script',cursive}
    .gradient-text{background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .card{background:rgba(255,255,255,0.98);border:1px solid rgba(0,0,0,0.04);border-radius:14px;box-shadow:0 10px 30px rgba(138,43,226,0.06)}
    .btn{padding:.62rem .9rem;border-radius:.75rem;font-weight:600}
    .btn-primary{background:linear-gradient(90deg,var(--primary),#b266ff);color:#fff}
    .btn-accent{background:linear-gradient(90deg,var(--accent),#ff97b8);color:#4a1d6a}
    .input{padding:.6rem .8rem;border-radius:.6rem;border:1px solid #e6e6e6}
    .thumb{width:100%;height:180px;object-fit:cover;border-radius:12px}
    .back-btn{display:inline-flex;gap:.5rem;align-items:center;padding:.45rem .65rem;border-radius:10px;border:1px solid #eee;background:#fff}
    a { text-decoration:none }
    /* responsive constraints for long page */
    .container{max-width:1100px;margin:0 auto;padding:20px}
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="bg-white sticky top-0 z-40 shadow-sm">
    <div class="container flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <!-- logo placeholder -->
        <div id="logo" class="w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-babypink to-violet text-white font-bold dancing">H</div>
        <div>
          <a href="#home" class="dancing text-2xl gradient-text" onclick="showPage('home')">HumairaStudio</a>
          <div class="text-xs text-gray-500">Creative blog & lifestyle</div>
        </div>
      </div>

      <nav class="hidden md:flex items-center gap-6">
        <a class="text-gray-700 hover:text-violet" href="#home" onclick="showPage('home')">Home</a>
        <a class="text-gray-700 hover:text-violet" href="#categories" onclick="showPage('categories')">Categories</a>
        <a class="text-gray-700 hover:text-violet" href="#about" onclick="showPage('about')">About</a>
        <a class="text-gray-700 hover:text-violet" href="#contact" onclick="showPage('contact')">Contact</a>
        <button onclick="showAdminLogin()" class="btn btn-primary text-sm">Admin</button>
      </nav>

      <button id="mobileToggle" class="md:hidden" onclick="document.getElementById('mobileMenu').classList.toggle('hidden')">
        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>

    <div id="mobileMenu" class="hidden md:hidden border-t">
      <div class="container flex flex-col py-3 gap-3">
        <a href="#home" onclick="showPage('home')">Home</a>
        <a href="#categories" onclick="showPage('categories')">Categories</a>
        <a href="#about" onclick="showPage('about')">About</a>
        <a href="#contact" onclick="showPage('contact')">Contact</a>
      </div>
    </div>
  </header>

  <!-- ADMIN LOGIN MODAL -->
  <div id="adminModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-lg">
      <h3 id="adminModalTitle" class="text-xl font-semibold mb-3">Admin Login</h3>
      <p id="adminModalSubtitle" class="text-gray-600 mb-4">Enter credentials or set them up if first time.</p>

      <!-- setup -->
      <form id="setupForm" class="space-y-3 hidden" onsubmit="handleSetup(event)">
        <input id="setupUser" class="input w-full" placeholder="Choose admin username" required />
        <input id="setupPass" type="password" class="input w-full" placeholder="Choose password (min 6 chars)" required />
        <div class="flex gap-3">
          <button class="btn btn-primary" type="submit">Create Admin</button>
          <button type="button" class="btn bg-gray-100" onclick="closeAdmin()">Cancel</button>
        </div>
      </form>

      <!-- login -->
      <form id="loginForm" class="space-y-3 hidden" onsubmit="handleLogin(event)">
        <input id="loginUser" class="input w-full" placeholder="Username" required />
        <input id="loginPass" type="password" class="input w-full" placeholder="Password" required />
        <div class="flex gap-3">
          <button class="btn btn-primary" type="submit">Login</button>
          <button type="button" class="btn bg-gray-100" onclick="closeAdmin()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ADMIN PANEL (hidden) -->
  <div id="adminPanel" class="fixed inset-0 bg-black/60 hidden z-50 p-6 overflow-auto">
    <div class="mx-auto max-w-4xl bg-white rounded-xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-2xl font-semibold">Admin Panel</h3>
        <div class="flex items-center gap-2">
          <span id="adminNameBadge" class="text-sm text-gray-600"></span>
          <button class="btn bg-gray-100" onclick="logoutAdmin()">Logout</button>
          <button class="text-2xl text-gray-400 ml-2" onclick="closeAdminPanel()">×</button>
        </div>
      </div>

      <div id="adminArea">
        <div class="flex gap-3 mb-4">
          <button class="btn btn-primary" onclick="showCreate()">Write a Post</button>
          <button class="btn bg-gray-100" onclick="showManage()">Manage Posts</button>
        </div>

        <div id="adminContent"></div>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <main class="container pt-8 pb-16">

    <!-- HOME -->
    <section id="page-home">
      <div class="text-center mb-8">
        <h1 class="text-5xl dancing gradient-text">Welcome to HumairaStudio</h1>
        <p class="text-gray-600 mt-2">Creative writing, recipes, student life & gentle inspiration.</p>
      </div>

      <!-- latest posts -->
      <div class="grid md:grid-cols-3 gap-6" id="latestGrid"></div>
      <div class="mt-6 text-center"><button class="btn btn-accent" onclick="showPage('categories')">Explore All Categories</button></div>
    </section>

    <!-- CATEGORIES HUB -->
    <section id="page-categories" class="hidden">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-semibold gradient-text">Categories</h2>
        <p class="text-gray-600">Choose a topic to explore posts</p>
      </div>
      <div id="categoryGrid" class="grid md:grid-cols-3 gap-6"></div>
    </section>

    <!-- CATEGORY VIEW -->
    <section id="page-category" class="hidden">
      <div class="flex items-center gap-4 mb-6">
        <button class="back-btn" onclick="goBack()">← Back</button>
        <h2 id="categoryTitle" class="text-2xl font-semibold"></h2>
      </div>
      <div id="categoryPosts" class="grid md:grid-cols-2 gap-6"></div>
    </section>

    <!-- POST VIEW -->
    <section id="page-post" class="hidden">
      <div class="flex items-center gap-4 mb-6">
        <button class="back-btn" onclick="goBack()">← Back</button>
        <h2 id="postTitle" class="text-2xl font-semibold"></h2>
      </div>
      <article id="postArticle" class="card p-6 max-w-3xl"></article>
    </section>

    <!-- ABOUT -->
    <section id="page-about" class="hidden">
      <div class="grid md:grid-cols-2 gap-6 items-center">
        <div>
          <h2 class="text-3xl font-semibold gradient-text">About Humaira</h2>
          <p class="text-gray-700 mt-3 leading-relaxed">Hi — I'm Humaira. I write about creative projects, simple recipes, and student life. I love minimal design, cozy coffee, and learning new things. This blog collects small ideas that brighten daily life.</p>
          <div class="mt-4">
            <a href="mailto:lijuhumaira2001@gmail.com" class="text-violet">lijuhumaira2001@gmail.com</a><br>
            <a href="https://www.linkedin.com/in/humaira-liju-816a18251?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank" class="text-violet">LinkedIn: Humaira Liju</a>
          </div>
        </div>
        <div>
          <!-- about image placeholder -->
          <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=1e9443ed5d9c8c9f0a1f1e7d9f3b6f7a" alt="Humaira" class="thumb">
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="page-contact" class="hidden">
      <div class="max-w-3xl mx-auto card p-6">
        <h2 class="text-2xl font-semibold gradient-text mb-3">Contact</h2>
        <p class="text-gray-700 mb-4">Email or connect on LinkedIn — I reply to collaborations and messages.</p>
        <div class="grid gap-3">
          <a class="btn btn-primary" href="mailto:lijuhumaira2001@gmail.com">Email Me</a>
          <a class="btn btn-accent" href="https://www.linkedin.com/in/humaira-liju-816a18251?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank">LinkedIn</a>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-white border-t py-8">
    <div class="container text-center">
      <div class="mb-3">
        <div class="dancing text-2xl gradient-text">HumairaStudio</div>
        <div class="text-sm text-gray-600 mt-1">© <span id="ftYear"></span> Humaira Liju</div>
      </div>
      <div class="flex items-center justify-center gap-4 text-sm text-gray-600">
        <a href="mailto:lijuhumaira2001@gmail.com">lijuhumaira2001@gmail.com</a>
        <span>•</span>
        <a href="https://www.linkedin.com/in/humaira-liju-816a18251?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app" target="_blank">LinkedIn</a>
      </div>
    </div>
  </footer>

  <!-- Templates -->
  <template id="cardTpl">
    <div class="card p-4 hover:shadow-lg">
      <img class="thumb mb-3" />
      <h3 class="text-lg font-semibold mb-2"></h3>
      <p class="text-gray-600 text-sm mb-3"></p>
      <div class="text-sm text-gray-500"></div>
    </div>
  </template>

<script>
/* ============================
   Site Data + Local Storage API
   ============================ */
const CATS = [
  {title:'Creative Writing', slug:'creative-writing'},
  {title:'Recipes', slug:'recipes'},
  {title:'Lifestyle', slug:'lifestyle'},
  {title:'Skincare', slug:'skincare'},
  {title:'Coffee', slug:'coffee'}
];

const STORAGE = {
  postsKey: 'humaira_posts_v2',
  adminKey: 'humaira_admin_v2',
  sessionKey: 'humaira_session_v2',
  seedKey: 'humaira_seed_v2',
  readPosts(){ try { return JSON.parse(localStorage.getItem(this.postsKey)||'[]') } catch(e){ return [] } },
  writePosts(arr){ localStorage.setItem(this.postsKey, JSON.stringify(arr)) }
};

/* Helper */
function uid(){ return 'id_'+Math.random().toString(36).slice(2,10) }
function fmtDate(ts){ return new Date(ts).toLocaleDateString() }
function goBack(){ if(history.length>1) history.back(); else showPage('categories') }

/* ============================
   Seed default posts (once)
   ============================ */
(function seedOnce(){
  if(localStorage.getItem(STORAGE.seedKey)) return;
  const sample = [];

  // Creative Writing (3)
  sample.push({
    id: uid(),
    title: 'The Usage of Notion for Students',
    category: 'creative-writing',
    created: Date.now() - 1000*60*60*24*3,
    cover: 'https://images.unsplash.com/photo-1557800636-894a64c1696f?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=2e4b5e35b1f3f6a2',
    content: `Notion is one of the most powerful productivity tools for students. It works like a digital notebook where you can organize class notes, track assignments, and manage projects in one place. Students can create pages for different subjects, link resources, and even collaborate with classmates. Unlike traditional note-taking apps, Notion allows full customization—you can design study planners, exam schedules, or personal journals with templates. Its database feature helps students manage reading lists or research work effectively. Another benefit is accessibility—everything is synced across devices, so you can study from anywhere. For group work, shared pages allow easy communication and task division. Students who struggle with time management find Notion especially useful because it combines task lists, calendars, and reminders into one streamlined tool. By using Notion, students don’t just stay organized—they actually build a system that makes learning easier, faster, and more enjoyable.`
  });
  sample.push({
    id: uid(),
    title: 'A Tiny Sunday Story',
    category: 'creative-writing',
    created: Date.now() - 1000*60*60*24*6,
    cover: 'https://images.unsplash.com/photo-1517694712202-14dd9538aa97?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=3e3f8a1c3b8ef3c7',
    content: `There are small Sundays that feel like a warm cup of tea: slow, bright, and easy. Today, I write short sentences about quiet rooms and the way sunlight finds the corners of my desk.`
  });
  sample.push({
    id: uid(),
    title: 'Writing Prompt: The Purple Envelope',
    category: 'creative-writing',
    created: Date.now() - 1000*60*60*24*9,
    cover: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=7a458d0b6fa4dd2a',
    content: `A purple envelope arrives with no return address. It’s the start of a small mystery and a good reason to write.`
  });

  // Recipes (3)
  sample.push({
    id: uid(),
    title: 'Simple Chocolate Chip Cookies',
    category: 'recipes',
    created: Date.now() - 1000*60*60*24*2,
    cover: 'https://images.unsplash.com/photo-1542200550-0b3e7b0d9e30?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=0d5c5f1a6f7a7b3d',
    content: `Short, buttery chocolate chip cookies — a minimalist recipe: mix butter, sugar, egg, flour, baking soda, salt, and chocolate chips. Chill 30 mins, bake 10–12 minutes at 180°C.`
  });
  sample.push({
    id: uid(),
    title: 'Morning Pancake Stack',
    category: 'recipes',
    created: Date.now() - 1000*60*60*24*12,
    cover: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=3b9a8c7c7c7f1d1f',
    content: `A fluffy pancake recipe that keeps things simple: whisk milk, egg, flour, baking powder, pinch of salt; cook small rounds on low-medium heat.`
  });
  sample.push({
    id: uid(),
    title: 'Masala Chai — Simple at Home',
    category: 'recipes',
    created: Date.now() - 1000*60*60*24*20,
    cover: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=da6f8ad3b2c1f7c8',
    content: `Brew strong tea with milk, sugar, and crushed spices (cardamom, cinnamon). Simmer gently for 5 minutes — strain and enjoy.`
  });

  // Lifestyle (3)
  sample.push({
    id: uid(),
    title: 'My Morning Routine for Focus',
    category: 'lifestyle',
    created: Date.now() - 1000*60*60*24*4,
    cover: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=2d6f3f3c4b3a8fd1',
    content: `A gentle morning: wake up, hydrate, 10 minutes of light stretching, 20 minutes of focused study, and a small breakfast.`
  });
  sample.push({
    id: uid(),
    title: 'Packing Light for Short Trips',
    category: 'lifestyle',
    created: Date.now() - 1000*60*60*24*14,
    cover: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=4f9a1b6a3d2a1f6c',
    content: `Choose neutral outfits, limit shoes, and use packing cubes. Keep toiletries minimal.`
  });
  sample.push({
    id: uid(),
    title: 'Quiet Evenings: How I Unwind',
    category: 'lifestyle',
    created: Date.now() - 1000*60*60*24*18,
    cover: 'https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=9d3f2b8a4e0f6b3a',
    content: `Reading, herbal tea, and a short reflection journal — a 30-minute routine to close the day.`
  });

  // Skincare (3)
  sample.push({
    id: uid(),
    title: '5-Minute Hydrating Face Mask',
    category: 'skincare',
    created: Date.now() - 1000*60*60*24*7,
    cover: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=1e9443ed5d9c8c9f0a1f1e7d9f3b6f7a',
    content: `Mix honey and yogurt, apply 5–10 minutes, rinse for a soft glow. Simple and nourishing.`
  });
  sample.push({
    id: uid(),
    title: 'Nightly Skincare Routine — Minimal',
    category: 'skincare',
    created: Date.now() - 1000*60*60*24*11,
    cover: 'https://images.unsplash.com/photo-1588774069265-7b8b8b8a1f3a?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=ab38f7b2c4a9b8d1',
    content: `Cleanse, hydrate with serum, apply light moisturizer. Add sunscreen in morning.`
  });
  sample.push({
    id: uid(),
    title: 'Face Oil for Winter',
    category: 'skincare',
    created: Date.now() - 1000*60*60*24*22,
    cover: 'https://images.unsplash.com/photo-1536305030013-3c8c7d4a6b1e?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=7f3e1c8a6b1c8d2f',
    content: `A light jojoba oil massage helps lock moisture during cold weather.`
  });

  // Coffee (3)
  sample.push({
    id: uid(),
    title: 'How to Brew Perfect Pour Over',
    category: 'coffee',
    created: Date.now() - 1000*60*60*24*5,
    cover: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=0d3f4e5a1b6c7d8e',
    content: `Use medium-fine grind, 92°C water, bloom 30s, pour slowly for 3 minutes. Clean rinse and enjoy.`
  });
  sample.push({
    id: uid(),
    title: 'Latte Art Basics — Foam & Pitcher',
    category: 'coffee',
    created: Date.now() - 1000*60*60*24*13,
    cover: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=da6f8ad3b2c1f7c8',
    content: `Perfect microfoam is key. Steam milk until shiny, pour steadily, and practice simple heart shapes.`
  });
  sample.push({
    id: uid(),
    title: 'Simple Cold Brew at Home',
    category: 'coffee',
    created: Date.now() - 1000*60*60*24*25,
    cover: 'https://images.unsplash.com/photo-1541167760496-1628856ab772?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=6dbf2f1c4a3e0d5b',
    content: `Coarse grind, 1:8 coffee-water ratio, steep 16 hours, strain, dilute and serve over ice.`
  });

  // write to storage
  localStorage.setItem(STORAGE.postsKey, JSON.stringify(sample));
  localStorage.setItem(STORAGE.seedKey, '1');
})();

/* ============================
   Rendering Functions
   ============================ */

function getPosts(){
  return STORAGE.readPosts ? STORAGE.readPosts() : JSON.parse(localStorage.getItem(STORAGE.postsKey) || '[]');
}

function renderLatest(){
  const container = document.getElementById('latestGrid');
  container.innerHTML = '';
  const posts = getPosts().sort((a,b)=>b.created - a.created).slice(0,6);
  posts.forEach(p=>{
    const tpl = document.getElementById('cardTpl').content.cloneNode(true);
    tpl.querySelector('img').src = p.cover || 'https://via.placeholder.com/800x450?text=HumairaStudio';
    tpl.querySelector('h3').textContent = p.title;
    tpl.querySelector('p').textContent = (p.content||'').substring(0,120) + '...';
    tpl.querySelector('div').textContent = fmtDate(p.created);
    tpl.querySelector('div.card').addEventListener('click', ()=> showPost(p.id));
    // fallback: make the whole card clickable
    const card = tpl.querySelector('div');
    card.style.cursor = 'pointer';
    card.addEventListener('click', ()=> showPost(p.id));
    container.appendChild(tpl);
  });
}

function renderCategories(){
  const grid = document.getElementById('categoryGrid');
  grid.innerHTML = '';
  CATS.forEach(c=>{
    const el = document.createElement('div');
    el.className = 'card p-6 cursor-pointer';
    el.innerHTML = `<h3 class="text-xl font-semibold mb-2">${c.title}</h3><p class="text-gray-600 text-sm">Explore ${c.title} posts</p>`;
    el.addEventListener('click', ()=> showCategory(c.slug));
    grid.appendChild(el);
  });
}

function showCategory(slug){
  const cat = CATS.find(c=>c.slug===slug);
  if(!cat) return;
  document.getElementById('categoryTitle').textContent = cat.title;
  const wrap = document.getElementById('categoryPosts');
  wrap.innerHTML = '';
  const posts = getPosts().filter(p=>p.category === slug).sort((a,b)=>b.created - a.created);
  if(posts.length === 0){
    wrap.innerHTML = '<div class="text-gray-500">No posts here yet.</div>';
  } else {
    posts.forEach(p=>{
      const box = document.createElement('div');
      box.className = 'card p-4';
      box.innerHTML = `
        <div class="md:flex gap-4">
          <div class="md:w-1/3"><img src="${p.cover||''}" class="thumb"></div>
          <div class="md:flex-1">
            <h3 class="text-lg font-semibold mb-2">${p.title}</h3>
            <p class="text-gray-600 mb-3">${(p.content||'').substring(0,160)}...</p>
            <div class="flex items-center gap-3">
              <button class="btn btn-primary" onclick="showPost('${p.id}')">Read</button>
              <button class="btn bg-gray-100" onclick="goBack()">Back</button>
            </div>
          </div>
        </div>`;
      wrap.appendChild(box);
    });
  }
  showOnly('category');
}

function showPost(id){
  const p = getPosts().find(x=>x.id===id);
  if(!p) return alert('Post not found');
  document.getElementById('postTitle').textContent = p.title;
  const art = document.getElementById('postArticle');
  art.innerHTML = `
    <div class="mb-4">
      <div class="text-sm text-gray-500">${fmtDate(p.created)} • <span class="text-violet font-semibold">${(CATS.find(c=>c.slug===p.category)||{}).title||p.category}</span></div>
      ${p.cover ? `<img src="${p.cover}" class="thumb mb-4">` : ''}
    </div>
    <div class="prose">${(p.content||'').replace(/\n/g,'<br>')}</div>
    <div class="mt-6"><button class="btn bg-gray-100" onclick="goBack()">Back</button></div>
  `;
  showOnly('post');
}

function showPage(name){
  // hide all page sections
  ['home','categories','category','post','about','contact'].forEach(p=>{
    const el = document.getElementById('page-'+p);
    if(el) el.classList.add('hidden');
  });
  const el = document.getElementById('page-'+name);
  if(!el) return;
  el.classList.remove('hidden');

  // additional render logic
  if(name === 'home') {
    renderLatest();
  } else if(name === 'categories'){
    renderCategories();
  } else if(name === 'about'){
    // nothing extra
  } else if(name === 'contact'){
    // nothing extra
  }
}

/* ============================
   Admin: single-owner auth + UI
   ============================ */

async function sha256(msg){
  const enc = new TextEncoder().encode(msg);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

function isLoggedIn(){ return !!localStorage.getItem(STORAGE.sessionKey) }

function showAdminLogin(){
  const has = !!localStorage.getItem(STORAGE.adminKey);
  document.getElementById('adminModal').classList.remove('hidden');
  document.getElementById('setupForm').classList.toggle('hidden', has);
  document.getElementById('loginForm').classList.toggle('hidden', !has);
  document.getElementById('adminModalTitle').textContent = has ? 'Admin Login' : 'Create Admin Account';
  document.getElementById('adminModalSubtitle').textContent = has ? 'Enter your credentials' : 'Set username & password';
}

function closeAdmin(){ document.getElementById('adminModal').classList.add('hidden') }

async function handleSetup(e){
  e.preventDefault();
  const u = document.getElementById('setupUser').value.trim();
  const p = document.getElementById('setupPass').value;
  if(u.length < 2 || p.length < 6) return alert('Username length >=2 and password >=6');
  const salt = Math.random().toString(36).slice(2);
  const hash = await sha256(p + salt);
  localStorage.setItem(STORAGE.adminKey, JSON.stringify({u, salt, hash}));
  localStorage.setItem(STORAGE.sessionKey, u);
  closeAdmin();
  openAdminPanel();
}

async function handleLogin(e){
  e.preventDefault();
  const data = JSON.parse(localStorage.getItem(STORAGE.adminKey) || '{}');
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  const test = await sha256(p + (data.salt || ''));
  if(data.u === u && data.hash === test){
    localStorage.setItem(STORAGE.sessionKey, u);
    closeAdmin();
    openAdminPanel();
  } else {
    alert('Invalid login');
  }
}

function openAdminPanel(){
  if(!isLoggedIn()) return showAdminLogin();
  document.getElementById('adminPanel').classList.remove('hidden');
  document.getElementById('adminNameBadge').textContent = localStorage.getItem(STORAGE.sessionKey) || '';
  showManage();
}

function closeAdminPanel(){ document.getElementById('adminPanel').classList.add('hidden') }

function logoutAdmin(){
  localStorage.removeItem(STORAGE.sessionKey);
  closeAdminPanel();
}

/* Admin Views: create/manage/edit posts */
function showCreate(){
  if(!isLoggedIn()) return showAdminLogin();
  const catOptions = CATS.map(c=>`<option value="${c.slug}">${c.title}</option>`).join('');
  document.getElementById('adminContent').innerHTML = `
    <form onsubmit="savePost(event)" class="space-y-3">
      <input id="postTitleIn" class="input w-full" placeholder="Post title" required />
      <select id="postCategoryIn" class="input w-full">${catOptions}</select>
      <input id="postCoverIn" class="input w-full" placeholder="Cover image URL (optional)" />
      <textarea id="postContentIn" class="input w-full min-h-[160px]" placeholder="Write content..." required></textarea>
      <div class="flex gap-3">
        <button class="btn btn-primary" type="submit">Publish</button>
        <button type="button" class="btn bg-gray-100" onclick="showManage()">Cancel</button>
      </div>
    </form>`;
}

function showManage(){
  if(!isLoggedIn()) return showAdminLogin();
  const posts = getPosts().sort((a,b)=>b.created - a.created);
  if(posts.length === 0){
    document.getElementById('adminContent').innerHTML = '<div class="text-gray-500">No posts yet</div>';
    return;
  }
  const html = posts.map(p=>`
    <div class="card p-3 mb-3 flex items-center justify-between">
      <div>
        <div class="font-semibold">${p.title}</div>
        <div class="text-sm text-gray-500">${(CATS.find(c=>c.slug===p.category)||{}).title || p.category} • ${fmtDate(p.created)}</div>
      </div>
      <div class="flex gap-2">
        <button class="btn bg-gray-100" onclick="editPost('${p.id}')">Edit</button>
        <button class="btn bg-red-100 text-red-700" onclick="deletePost('${p.id}')">Delete</button>
      </div>
    </div>
  `).join('');
  document.getElementById('adminContent').innerHTML = html;
}

function savePost(e){
  e.preventDefault();
  const id = document.getElementById('postIdIn') ? document.getElementById('postIdIn').value : null;
  const title = document.getElementById('postTitleIn').value.trim();
  const category = document.getElementById('postCategoryIn').value;
  const cover = document.getElementById('postCoverIn').value.trim();
  const content = document.getElementById('postContentIn').value.trim();
  if(!title || !category || !content) return alert('Please fill title, category and content');
  const posts = getPosts();
  if(id){
    const p = posts.find(x=>x.id===id);
    if(p){ p.title = title; p.category = category; p.cover = cover; p.content = content; p.updated = Date.now(); }
  } else {
    posts.push({id: uid(), title, category, cover, content, created: Date.now()});
  }
  localStorage.setItem(STORAGE.postsKey, JSON.stringify(posts));
  alert('Saved');
  renderLatest(); showManage();
}

function editPost(id){
  if(!isLoggedIn()) return showAdminLogin();
  const p = getPosts().find(x=>x.id===id); if(!p) return alert('Not found');
  const catOptions = CATS.map(c=>`<option value="${c.slug}" ${p.category===c.slug?'selected':''}>${c.title}</option>`).join('');
  document.getElementById('adminContent').innerHTML = `
    <form onsubmit="saveEditedPost(event)" class="space-y-3">
      <input type="hidden" id="postIdIn" value="${p.id}" />
      <input id="postTitleIn" class="input w-full" value="${(p.title||'').replace(/"/g,'&quot;')}" required />
      <select id="postCategoryIn" class="input w-full">${catOptions}</select>
      <input id="postCoverIn" class="input w-full" value="${(p.cover||'').replace(/"/g,'&quot;')}" />
      <textarea id="postContentIn" class="input w-full min-h-[160px]" required>${(p.content||'').replace(/</g,'&lt;')}</textarea>
      <div class="flex gap-3">
        <button class="btn btn-primary" type="submit">Update</button>
        <button type="button" class="btn bg-gray-100" onclick="showManage()">Cancel</button>
      </div>
    </form>`;
}

function saveEditedPost(e){
  e.preventDefault();
  const id = document.getElementById('postIdIn').value;
  const title = document.getElementById('postTitleIn').value.trim();
  const category = document.getElementById('postCategoryIn').value;
  const cover = document.getElementById('postCoverIn').value.trim();
  const content = document.getElementById('postContentIn').value.trim();
  const posts = getPosts();
  const idx = posts.findIndex(p=>p.id===id);
  if(idx === -1) return alert('Not found');
  posts[idx] = Object.assign({}, posts[idx], {title, category, cover, content, updated: Date.now()});
  localStorage.setItem(STORAGE.postsKey, JSON.stringify(posts));
  alert('Updated');
  renderLatest(); showManage();
}

function deletePost(id){
  if(!confirm('Delete this post?')) return;
  const posts = getPosts().filter(p=>p.id !== id);
  localStorage.setItem(STORAGE.postsKey, JSON.stringify(posts));
  renderLatest(); showManage();
}

/* ============================
   Initialization
   ============================ */
document.getElementById('ftYear').textContent = new Date().getFullYear();
renderLatest();
renderCategories();
showPage('home');

/* Hash routing support (optional): allow /#category/slug or /#post/id */
window.addEventListener('hashchange', ()=>{
  const h = location.hash.replace(/^#\/?/, '');
  if(!h) return showPage('home');
  const [first, second] = h.split('/');
  if(first==='category' && second) return showCategory(second);
  if(first==='post' && second) return showPost(second);
  if(['home','categories','about','contact'].includes(first)) return showPage(first);
});
</script>
</body>
</html>
